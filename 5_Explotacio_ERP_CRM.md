---
title: UD05: Explotaci√≥ de sistemes ERP-CRM
language: VAL
author: Toni Santos Silvestre [https://github.com/ToniSantosSilvestre]
subject: Sistemes de Gesti√≥ Empresarial
keywords: [SGE, 2024, Sistemes de Gesti√≥ Empresarial,Python]
IES: CIPFP Batoi (Alcoi) [https://portal.edu.gva.es/cipfpbatoi/]
header: ${title} - ${subject} (ver: ${today})
footer:${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}/${pageCount}
typora-root-url:${filename}/../
typora-copy-images-to:${filename}/../assets
---

[TOC]

## 1. INTRODUCCI√ì
Odoo √©s un ERP-CRM de codi obert que es distribueix sota dos tipus de desplegament:

- On-premise en GNU/Linux o Windows amb dues versions (Community, gratu√Øta i Enterprise, de pagament).
- SaaS (Programari As A Service): l‚Äôempresa que desenvolupa Odoo tamb√© proporciona el seu servei en el n√∫vol. 

D'aquesta manera, una empresa pot tenir el seu propi Odoo en un servidor local, en un n√∫vol propi o en un n√∫vol de tercers. Tamb√© pot tenir acc√©s a Odoo pel SaaS d'Odoo o d'altres terceres empreses que proporcionen Odoo com SaaS.

La llic√®ncia d'Odoo ha anat canviant al llarg del temps. La llic√®ncia actual, de la versi√≥ 18 'Community' √©s LGPLv3.

Odoo t√© una arquitectura ‚Äúclient-servidor‚Äù de 3 capes:

- La base de dades en un servidor PostgreSQL.
- El servidor Odoo, que engloba la l√≤gica de negoci i el servidor web.
- La capa de client que √©s un SPA (Single Page Application). La capa client est√† dividida en almenys 3 interf√≠cies molt diferenciades:
    - El ‚ÄúBackend‚Äù on s'administra la base de dades per part dels administradors i empleats de l'empresa.
    - El ‚ÄúFrontend‚Äù o p√†gina web, on poden accedir els clients i empleats. Pot incloure una botiga i altres aplicacions.
    - El ‚ÄúTPV‚Äù per als terminals punt de venda que poden ser t√†ctils.

> üí¨ **Atenci√≥**: a m√©s d'usar el seu propi client, Odoo admet que altres aplicacions interactuen amb el seu servidor usant XML-RPC. Tamb√© es poden desenvolupar ‚Äúweb controllers‚Äù per a crear una API per a aplicacions web o m√≤bils, per exemple.

A part de l'arquitectura de 3 capes, Odoo √©s un sistema modular. Aix√≤ vol dir que es pot ampliar amb m√≤duls de tercers (oficials o no) i m√≤duls desenvolupats per nosaltres mateixos.

De fet, en Odoo hi ha un m√≤dul ‚Äúbase‚Äù que cont√© el funcionament b√†sic del servidor i a partir d'ac√≠ es carreguen tots els altres m√≤duls.

Quan instal¬∑lem Odoo, abans d'instal¬∑lar cap m√≤dul, tenim acc√©s al ‚Äúbackend‚Äù on gestionar poc m√©s que les opcions i usuaris. √âs necessari instal¬∑lar els m√≤duls necessaris per a un funcionament m√≠nim. Per exemple, el m√©s t√≠pic √©s instal¬∑lar almenys els m√≤duls de vendes, compres, CRM i comptabilitat.

Per a ampliar les funcionalitats o adaptar Odoo a les necessitats d'una empresa, no cal modificar el codi font d'Odoo. Tan sols necessitem crear un m√≤dul.

Els **m√≤duls d'Odoo** poden modificar el comportament del programa, l'estructura de la base de dades i/o la interf√≠cie d'usuari. En principi, un m√≤dul es pot instal¬∑lar i desinstal¬∑lar i els canvis que implicava el m√≤dul es reverteixen completament.
![Peticions de l'aplicaci√≥ d'Odoo](assets/imatges/05_01_esquema_peticions.png)

Odoo facilita el desenvolupament de m√≤duls perqu√®, a m√©s d'un ERP, √©s un framework de programaci√≥. Odoo t√© el seu propi framework tipus **RAD (Rapid Application Development)**. Aix√≤ significa que amb poc esfor√ß es poden aconseguir aplicacions amb altes prestacions i segures.

>‚ùï**Atenci√≥**: el poc esfor√ß √©s relatiu. Per a desenvolupar correctament en Odoo s√≥n necessaris amplis coneixements de Python, XML, HTML, Javascript i altres tecnologies associades com QWeb, JQuery, XML-RPC, etc. La corba d'aprenentatge √©s alta i la documentaci√≥ √©s escassa. A m√©s, els errors s√≥n m√©s dif√≠cils d'interpretar perqu√® no sabem tot el que est√† passant per davall. La frustraci√≥ inicial es veur√† compensada amb una major agilitat i menys errors.

Aquest framework es basa en alguns dels principis generals dels RAD moderns:

- La capa **ORM (Object Relational Mapping)** entre els objectes i la base de dades.
    - La combinaci√≥ **Classe Python ‚Üî ORM ‚Üî Tabla PostgreSQL** es coneix com a **Model**.
    - El programador no efectua el disseny de la base de dades, nom√©s de les classes i les seues relacions.
    - Tampoc √©s necessari fer consultes SQL, quasi tot es pot fer amb els m√®todes d'ORM d'Odoo.
- L‚Äôarquitectura **MVC** (Modelo-Vista-Controlador).
    - El model es programa declarant classes de Python que hereten de ‚Äú**models.Model**‚Äù. Aquesta her√®ncia provoca que actue l'ORM i √©s mapejen en la base de dades.
    - Les vistes es defineixen normalment en arxius XML i s√≥n llistes, formularis, calendaris, gr√†fics, men√∫s, etc. Aquest XML ser√† enviat al client web on el framework Javascript d'Odoo ho transforma en HTML.
    - El controlador tamb√© es defineix en fitxers Python, normalment al costat del model. El controlador s√≥n els m√®todes que proporcionen la l√≤gica de negoci.
- Odoo t√© una arquitectura de **Tinen√ßa M√∫ltiple**. De manera que un √∫nic servidor pot proporcionar servei a molts clients de bases de dades diferents.
- Odoo proporciona un dissenyador d'informes.
- El framework facilita la traducci√≥ de l'aplicaci√≥ a molts idiomes.

> üìñ **Important**: ja que Odoo facilita la traducci√≥, √©s una bona pr√†ctica programar tot en angl√©s, tant el nom de les variables com els textos que vam mostrar als usuaris. Posteriorment, podem afegir les traduccions necess√†ries.



## 2 La base de dades d'Odoo

Gr√†cies a l'ORM, no hi ha un disseny definit de la base de dades. La base de dades d'una empresa pot tenir algunes taules molt diferents d‚Äôaltres en funci√≥ del mapatge que l'ORM haja fet amb les classes actives en aquesta empresa. Per tant, √©s dif√≠cil trobar un disseny ‚Äúentitat-relaci√≥‚Äù o una cosa similar en la documentaci√≥ d'Odoo.

Cal afegir que Odoo t√© alguns models ja creats i ben documentats com:
- ‚Äúres.partner‚Äù (clients, prove√Ødors, etc.).
    - https://www.technaureus.com/odoo-partner-res-partner-concept/
- ‚Äúsale.order‚Äù (Ordre de venda).

Aquests models existeixen de base pel fet que estan en quasi totes les empreses i versions d'Odoo.

Per√≤ ni tan sols aquests tenen en la base de dades les mateixes columnes o relacions que en altres empreses. Moltes vegades necessitem saber el nom del model, del camp o de la taula en la base de dades. Per a aix√≤, Odoo proporciona en el seu ‚Äúbackend‚Äù el ‚Äúmode desenvolupador‚Äù per a saber el model i camp posant el ratol√≠ damunt d'un camp dels formularis.

> üìñ **Important**: el nom de les classes de Python sempre ha de ser en min√∫scula i amb el  punt per a separar per jerarquia. El nom d'un model, per tant, ser√†  sempre: ‚Äúmodul.model‚Äù. Si el model t√© un nom compost, se separa per ‚Äú_‚Äù.

> En la base de dades, el punt se substitueix per una barra baixa.



> üí¨ **Interessant**: aconsellem dedicar uns minuts a con√©ixer la base de dades usant el ‚Äúmode  desenvolupador‚Äù i el client de terminal de PostgreSQL. Per a aix√≤, podem repassar les consultes SQL traient, per exemple, el nom dels clients  que no han fet cap comanda.

## 3. Composici√≥ d'un m√≤dul

Odoo √©s un programa modular. Tant el servidor com el client es componen de m√≤duls que estenen al m√≤dul ‚Äúbase‚Äù. Qualsevol cosa que es vulga modificar en Odoo s'ha de fer creant un m√≤dul.

>üìñ **Important:** ja que Odoo √©s de codi obert i tot el codi est√† en Python, que no √©s un llenguatge compilat, podem alterar els fitxers Python o XML dels m√≤duls oficials, canviant el que ens interesse.

>**Aix√≤ pot funcionar, per√≤ √©s una mala pr√†ctica, ja que:**

>\- Qualsevol actualitzaci√≥ dels m√≤duls oficials esborraria els nostres canvis.

>\- Si no actualitzem, perdrem acc√©s a nova funcionalitats i estarem exposats a problemes de seguretat.

>\- Revertir canvis √©s m√©s dif√≠cil i la soluci√≥ sol passar per tornar a la versi√≥ oficial.

Podem crear m√≤duls per a modificar, eliminar o ampliar parts d'altres m√≤duls. Tamb√© podem crear m√≤duls per a afegir funcionalitats completament noves a Odoo sense interferir amb la resta del programa. En qualsevol cas, el sistema modular est√† dissenyat perqu√® es puguen instal¬∑lar i desinstal¬∑lar m√≤duls sense afectar la resta del programa.

**Exemple**: pot ser que una empresa no necessite totes les dades que demana Odoo en registrar un producte. Com a soluci√≥, podem fer un m√≤dul que elimine de la vista els camps innecessaris. Si despr√©s es comprova que aquells camps eren necessaris, nom√©s cal desinstal¬∑lar el m√≤dul i tornen a apar√©ixer.

Aquest sistema modular funciona perqu√®, cada vegada que es reinicia el servidor o s'actualitza un m√≤dul, s'interpreten els fitxers Python que defineixen els models i l'ORM mapeja les novetats en la base de dades. A m√©s, es carreguen les dades dels fitxers XML en la base de dades i s'actualitzen les dades que han canviat.

### 3.1 Estructura d'un m√≤dul

Els m√≤duls modifiquen parts de Model-Vista-Controlador. D'aquesta manera, un m√≤dul es compon de fitxers Python, XML, CSS o Javascript entre altres. Tots aquests arxius han d'estar en una carpeta amb el nom del m√≤dul.



Hi ha una estructura de subcarpetes i de noms d'arxius que quasi tots els m√≤duls respecten. Per√≤ tot dep√©n del que pose en el fitxer ‚Äú**__manifest__.py‚Äù**. Aquest fitxer cont√© un diccionari de Python amb informaci√≥ del m√≤dul i la ubicaci√≥ dels altres fitxers. A m√©s, l'arxiu ‚Äú**__init__.py**‚Äù indica quins fitxers Python s'han d'importar.



Dins d'un m√≤dul podem trobar:

- Fitxers Python que defineixen els models i els controladors.
- Fitxers XML que defineixen dades que han d'anar a la base de dades. Dins d'aquestes dades, podem trobar:
    - Definici√≥ de les vistes i les accions.
    - Dades de demo.
    - Dades est√†tiques que necessita el m√≤dul.
- Fitxers est√†tics com a imatges, CSS, Javascript, etc. que han de ser carregats per la interf√≠cie web.
- Controladors web per a gestionar les peticions web.

Els m√≤duls es guarden en un directori indicat en l'opci√≥ ‚Äú**--addons-path**‚Äù en llan√ßar el servidor o en el fitxer de configuraci√≥ ‚Äú**odoo.conf**‚Äù. Els m√≤duls poden estar en m√©s d'un directori i depenen de la mena d'instal¬∑laci√≥ o la distribuci√≥ o versi√≥ que s'instal¬∑le.



Per a crear un m√≤dul es pot fer manualment creat la carpeta, el manifest, els directoris i fitxers o utilitzant una eina de l√≠nia de comandos anomenada ‚Äú**odoo scaffold**‚Äù.

> odoo scaffold nom_del_modul /ruta_don_colocarlo

Una vegada executat aquest comando, tenim en la ruta indicada, l'estructura b√†sica de directoris i fitxers amb una mica de codi d'exemple.

> ‚ùï**Atenci√≥:** encara que usar ‚Äúscaffold‚Äù ens proporciona una base, durant la unitat pot ser bona idea basar-se en exemples proporcionats a classe.

## 4.  Models

### 4.1 Introducci√≥ als models en Odoo

Els models s√≥n una abstracci√≥ pr√≤pia de molts frameworks i relacionada amb l'ORM. Un model es defineix com una classe Python que hereta de la classe ‚Äú**models.Model**‚Äù. En heretar d'aquesta classe, adquireix unes propietats de manera transparent per al programador. A partir d'aquest moment, les classes del llenguatge de programaci√≥ queden per davall d'un nivell m√©s d'abstracci√≥.

Una classe heretada de ‚Äúmodels.Model‚Äù es comporta de la seg√ºent manera:

- Pot ser accedida com a model, com ‚Äúrecordset‚Äù (conjunt de registres) o com ‚Äúsingleton‚Äù (un unic registre). Si √©s accedida com a model, t√© m√®todes de model per a crear ‚Äúrecordsets‚Äù, per exemple. Si √©s accedida com ‚Äúrecordset‚Äù, es pot accedir a les dades que guarda.
- Pot tenir atributs interns de la classe, ja que continua sent Python. Per√≤ els atributs que es guarden en la base de dades s'han de definir com ‚Äúfields‚Äù. Un ‚Äúfield‚Äù √©s una inst√†ncia de la classe ‚Äúfields.Field‚Äù, i t√© els seus propis atributs i funcions.
    - Odoo analitzar√† el model, cercar√† els atributs tipus ‚Äúfield‚Äù i les seues propietats i mapear√° autom√†ticament tot aix√≤ en l'ORM.
- Els m√®todes definits per als ‚Äúrecordset‚Äù reben un argument anomenat ‚Äúself‚Äù que pot ser un ‚Äúrecordset‚Äù amb una col¬∑lecci√≥ de registres. Per tant, han d'iterar en el self per a fer la seua funci√≥ en cadascun dels registres.
- Un model representa a la taula sencera en la base de dades. Un ‚Äúrecordset‚Äù representa a una col¬∑lecci√≥ de registres d'aqueixa taula i tamb√© al model. Un ‚Äúsingleton‚Äù √©s un ‚Äúrecordset‚Äù d'un sol element.
- Els models tenen les seues pr√≤pies funcions per a no haver d'accedir a la base de dades per a modificar o crear registres. A m√©s, incorporen restriccions d'integritat.

Aquest √©s l'exemple d'un model amb solament un ‚Äúfield‚Äù:

![Model de classe d'Odoo](/assets/imatges/05_02_classe_model.png)

Sobre el codi anterior, vegem detalladament tot el que passa:

- Es defineix una classe de Python que hereta de ‚Äú**models.Model**‚Äù
- Es defineixen dos atributs ‚Äú**_name**‚Äù i ‚Äú**_description**‚Äù. El ‚Äú**_name**‚Äù √©s obligatori en els models i √©s el nom del model. Ac√≠ s'observa l'abstracci√≥, ja no s'accedir√† a la classe ‚Äú**Amodel**‚Äù, sin√≥ al model ‚Äú**a.model**‚Äù.
- Despr√©s est√† la definici√≥ d'un altre atribut tipus ‚Äú**field**‚Äù que ser√† mapatge per l'ORM en la base de dades. Com es pot observar, crida al constructor de la classe ‚Äú**fields.Char**‚Äù amb uns arguments. Tots els arguments s√≥n opcionals en el cas de ‚Äú**Char**‚Äù. Hi ha constructors per a tots els tipus de dades.

> üí¨ **Interessant**: √©s molt probable que a hores d'ara no entengues el perqu√® de la majoria  del codi anterior. Els frameworks requereixen entendre moltes coses  abans de poder comen√ßar. No obstant aix√≤, amb aquest fragment de codi ja tenim solucionat l'emmagatzematge en la base de dades, la integritat de les dades i part de la interacci√≥ amb l'usuari.

> üí¨ **Interessant**: Odoo est√† pensat perqu√® siga f√†cilment modificable per la web. Sense  necessitat d'entrar al codi. Aix√≤ √©s molt √∫til per a prototipar les  vistes, per exemple.
> Una de les  funcionalitats √©s la manera desenvolupador, que permet, entre moltes  altres coses, explorar els models que t√© en aquest moment el servidor. 

Els models tenen alguns atributs del model, com ‚Äú**_name**‚Äù o ‚Äú**_description**‚Äù. Un altre atribut de model important √©s ‚Äú**_rec_name**‚Äù que indica que atribut pren nom el registre i que per defecte apunta a l'atribut ‚Äúname‚Äù (no confondre amb ‚Äú_name‚Äù).

- En les vistes (que veurem m√©s endavant), en alguns camps es basa en l'atribut marcat per ‚Äú**_rec_name**‚Äù, que per defecte √©s ‚Äú**name**‚Äù. Si no tenim un atribut ‚Äúname‚Äù o volem que siga un altre atribut el que de nom, podem modificar-ho amb ‚Äú**_rec_name=‚Äônomatribut**‚Äô‚Äù.



 ### 4.2 Atributs tipus ‚Äúfield‚Äù simples

Els models tenen altres atributs tipus ‚Äúfield‚Äù, que es mapejen en la base  de dades i als quals l'usuari t√© acc√©s i m√®todes que conformen el  controlador. A continuaci√≥ detallarem tots els tipus de ‚Äúfield‚Äù que hi  ha i les seues possibilitats:

En primer lloc, definim els ‚Äúfields‚Äù de dades m√©s habituals:

- **Integer**
- **Char**
- **Text**
- **Date**
- **Datetime**
- **Float**
- **Boolean**
- **Html**
- **Binary**: arxius binaris que guarda en format base64. Poden guardar-se imatges o  altres elements. Abans d'Odoo 13 en aquest tipus de ‚Äúfields‚Äù es  guardaven les imatges.

Dins dels ‚Äúfields‚Äù de dades, hi ha alguns una mica m√©s complexos:

- **Image**: a partir de la versi√≥ 13 d'Odoo es poden guardar imatges en aquest  ‚Äúfield‚Äù. Cal definir el ‚Äúmax_width‚Äù o ‚Äúmax_height‚Äù i es redimensionar√†  en guardar. 
- **Selection**: guarda una dada, per√≤ cal dir-li amb una llista de tuples les opcions que t√©.

Ac√≠ un exemple de ‚ÄúSelection‚Äù:

```python
type = fields.Selection([('1','Basic'),('2','Intermediate'),('3','Completed')]) 

aselection = fields.Selection(selection='a_function_name') # se puede definir su contenido en una funci√≥n.
```

Tots els ‚Äúfields‚Äù esmentats tenen un constructor que funciona de la mateixa  manera que en l'exemple anterior. Poden tenir un nom, un valor per  defecte, o fins i tot pot definir-se el seu contingut mitjan√ßant una  funci√≥.

Al llarg d'aquest text es veuran exemples de com s'han definit ‚Äúfields‚Äù segons les necessitats.

### 4.3 Atributs ‚Äúfields‚Äù relacionals

A continuaci√≥, observarem els ‚Äúfields‚Äù relacionals. At√©s que l'ORM evita  que h√†gem de crear les taules i les seues relacions en la base de dades, quan existeixen relacions entre models es necessiten uns camps que  definisquen aquelles relacions.



**Exemple**: una comanda de venda t√© un client i un client pot fer moltes comandes de  venda. Al seu torn, aquesta comanda t√© moltes l√≠nies de comanda, que s√≥n nom√©s d‚Äôaquesta comanda i tenen un producte, que pot estar en moltes  l√≠nies de venda.



En situacions com la de l'exemple, aquestes relacions acaben estant en la  base de dades amb claus alienes. Per√≤ amb els frameworks que implementen ORM, tot aix√≤ √©s molt m√©s senzill.

Per a aix√≤ utilitzarem els ‚Äúfields‚Äù relacionals d'Odoo:

- **Many2one**: √©s el m√©s simple. Indica que el model en el qual est√† t√© una relaci√≥  molts a un amb un altre model. Aix√≤ significa que un registre t√© relaci√≥ amb un √∫nic registre de l'altre model, mentre que l'altre registre pot  tenir relaci√≥ amb molts registres del model que t√© el ‚ÄúMany2one‚Äù. En la  taula de la base de dades, aix√≤ es traduir√† en una clau aliena a l'altra taula.
    - Exemple on es pret√©n que cada ciutat emmagatzeme el seu pa√≠s.
    ![Exemple de relaci√≥ Many2One](/assets/imatges/05_03_relacio_many2one.png)

- Les de ‚Äúalumnes amb m√≤duls‚Äù, descrita en l'exemple anterior.
- Una nova relaci√≥, on es relacionen alumnes repetidors amb m√≤duls pendents.

No han de coincidir, per√≤ si no s'especifica una taula interm√®dia diferent, **Odoo considerar√† que √©s la mateixa relaci√≥**. En aquests casos cal especificar la taula interm√®dia amb la sintaxi completa per a evitar errors:

```python
alumnos_ids = fields.Many2many(comodel_name='modulo.alumno',
relation='modulos_alumnos', # El nombre de la tabla intermedia
column1='modulo_id', # El nombre en la tabla intermedia de la clave a este modelo
column2='alumno_id')  # El nombre de la clave al otro modelo.
repetidores_ids = fields.Many2many(comodel_name='modulo.alumno',
relation='modulos_alumnos_repetidores', # El nombre de la tabla intermedia
column1='modulo_id', # El nombre en la tabla intermedia de la clave a este modelo
column2='alumno_id')  # El nombre de la clave al otro modelo.
modulos_ids = field.Many2many(comodel_name='modulo.modulo',
relation='modulos_alumnos', # El nombre de la tabla intermedia
column1='alumno_id', # El nombre en la tabla intermedia de la clave a este modelo
column2='modulo_id')  # El nombre de la clave al otro modelo.
pendientes_ids = field.Many2many(comodel_name='modulo.modulo',
relation='modulos_alumnos_repetidores', # El nombre de la tabla intermedia
column1='alumno_id', # El nombre en la tabla intermedia de la clave a este modelo
column2='modulo_id')  # El nombre de la clave al otro modelo.
```

Les relacions ‚ÄúMany2one‚Äù, ‚ÄúOne2many‚Äù i ‚ÄúMany2many‚Äù suposen la majoria de les relacions necess√†ries en qualsevol programa. Hi ha un altre tipus de ‚Äúfields‚Äù relacionals especials que faciliten la programaci√≥:
- **related**: en realitat no √©s un tipus de ‚Äúfield‚Äù, sin√≥ una possible propietat de qualsevol dels tipus. El que fa un ‚Äúfield related‚Äù √©s mostrar una dada que est√† en un registre d'un altre model amb el qual es t√© una relaci√≥ ‚ÄúMany2one‚Äù.

Si prenem com a exemple l'anterior de les ciutats i pa√Øsos, imaginem que volem mostrar la bandera del pa√≠s en el qual est√† la ciutat. La bandera ser√† un camp ‚ÄúImage‚Äù que estar√† en el model pa√≠s, per√≤ el volem mostrar tamb√© en el model ciutat. Per a aix√≤ tenim dues possibles solucions:
- La soluci√≥ dolenta seria guardar la bandera en cada ciutat.

- La bona soluci√≥ √©s usar un ‚Äúfield related‚Äù per a accedir a la bandera.

  ```python
  pais_id = fields.Many2one('modulo.pais') # Esto en el modelo Ciudad
  bandera = fields.Image(related='pais_id.bandera') # Suponiendo que existe el field bandera y es de tipo Image.
  ```

  

>üìñ **Important**: el ‚Äúfield related‚Äù pot tenir 'store=True' si volem que ho guarde en la base de dades. En la majoria de casos √©s redundant i no serveix. Per√≤ pot ser que per raons de rendiment, o per a poder cercar, s'haja de guardar. Aix√≤ no respecta la tercera forma normal. En aqueix cas, Odoo s'encarrega de mantenir la coher√®ncia de les dades. 

>üìñ **Important**: un altre √∫s possible dels ‚Äúfield related‚Äù pot ser fer refer√®ncia a ‚Äúfields‚Äù del propi model per a tenir les dades repetides. Aix√≤ √©s molt √∫til en les imatges, per exemple, per a emmagatzemar versions amb diferents resolucions. Tamb√© pot ser √∫til per a mostrar els mateixos ‚Äúfields‚Äù amb diversos ‚Äúwidgets‚Äù.

- **Reference**: √©s una refer√®ncia a un camp arbitrari d'un model. En realitat no provoca una relaci√≥ en la base de dades. El que guarda √©s el nom del model i del camp en un ‚Äúfield char‚Äù.
- **Many2oneReference**: √©s un ‚ÄúMany2one‚Äù per√≤ en el qual tamb√© cal indicar el model al qual fa refer√®ncia. No s√≥n molt utilitzats.

> üí¨ **Interessant**: en algunes ocasions, influ√Øts pel pensament de les bases de dades relacionals, podem decidir que necessitem una relaci√≥ **‚ÄúOne2one‚Äù. Odoo va deixar d'usar-les per motius de rendiment i recomana en el seu lloc unir els dos models en un**. No obstant aix√≤, es pot imitar amb dos ‚ÄúMany2many‚Äù computats o un ‚ÄúOne2many‚Äù limitat a un sol registre. En els dos casos, ser√† tasca del programador garantir el bon funcionament d'aqueixa relaci√≥.

Una vegada estudiat el concepte de model i dels 'fields', detinguem-nos un moment a analitzar aquest codi que defineix 2 models:

```python
# -*- coding: utf-8 -*-
from odoo import models, fields, api
from openerp.exceptions import ValidationError
class net(models.Model):
    _name = 'networks.net'
    _description = 'Networks Model'
    name = fields.Char()
    net_ip = fields.Char()
    mask = fields.Integer()
    net_map = fields.image()
    net_class = fields.Selection([('a','A'),('b','B'),('c','C')])
    pcs = fields.One2many('networks.pc','net')
    servers = fields.Many2many('networks.pc',relation='net_servers')              
class pc(models.Model):
    _name = 'networks.pc'
    _description = 'PCs Model'
    name = fields.Char(default="PC")
    number = fields.Integer()
    ip = fields.Char()
    ping = fields.Float()
    registered = fields.Date()
    uptime = fields.Datetime()
    net = fields.Many2one('networks.net')
    user = fields.Many2one('res.partner')
    servers = fields.Many2many('networks.net',relation='net_servers')
```

Com es pot veure, estan quasi tots els tipus b√†sics de field. Tamb√© podem veure fields relacionals. Parem atenci√≥ al ‚ÄúMany2one‚Äù anomentat ‚Äúnet‚Äù dels ‚ÄúPC‚Äù que permet que funcione l'‚ÄùOne2many‚Äù anomenat ‚Äúpcs‚Äù del model ‚Äúnetworks.net‚Äù. Tamb√© s√≥n interessants els ‚ÄúMany2many‚Äù en els quals declarem el nom de la relaci√≥ per a controlar el nom de la taula interm√®dia.

Una vegada repassats els tipus de fields i vist un exemple, ja podr√≠em fer un m√≤dul amb dades est√†tiques i relacions entre els models. Ens faltaria la vista per a poder veure aquests models en el client web. Pots passar directament a l'apartat de la vista si vols tenir un m√≤dul funcional m√≠nim. Per√≤ en el model queden algunes coses que explicar.



### 4.4 Atributs ‚Äúfields‚Äù computats (‚Äúcomputed‚Äù)

Fins ara, els ‚Äúfields‚Äù que hem vist emmagatzemaven alguna cosa en la base de dades. No obstant aix√≤, pot ser que no vulguem que algunes dades esten  guardats en la base de dades, sin√≥ que es recalculen cada vegada que els veurem. En aqueix cas, cal utilitzar camps computats.

Un ‚Äúfield computed‚Äù es defineix igual que un normal, per√≤ entre els seus  arguments cal indicar el nom de la funci√≥ que el computa:

```python
taken_seats = fields.Float(string="Taken seats", compute='_taken_seats')
@api.depends('seats', 'attendee_ids')  # El decorador @api.depends() indica que se llama a  
                                 # la funci√≥n cada vez que cambie el valor de los fields
                                 # seats i attendee_ids.
def _taken_seats(self):
   for r in self:  # El for recorre self, que es un recordset con los registros activos              

if not r.seats: # r es un singleton y se puede acceder a los atributos como un objeto
         r.taken_seats = 0.0 # esta asignaci√≥n ya hace que se vea el resultado.
      else:
         r.taken_seats = 100.0 * len(r.attendee_ids) / r.seats
```
> üí¨** Interessant**: hi ha un truc per a poder tenir ‚Äúfields computed‚Äù amb ‚Äústore=False‚Äù i alhora poder cercar o ordenar. El que es pot fer √©s un altre ‚Äúfield‚Äù del mateix tipus que no siga ‚Äúcomputed‚Äù, per√≤ que se sobreescriga quan s'executa el m√®tode del qual s√≠ que √©s ‚Äúcomputed‚Äù. D'aquesta manera, es guarda en la base de dades, encara que es recalcula cada vegada. El problema √©s que han d'estar els dos ‚Äúfields‚Äù en la vista. Aix√≤ se soluciona posant ‚Äúinvisible=‚Äô1‚Äô‚Äù en el ‚Äúfield computed‚Äù. L'usuari no l'observa, no obstant aix√≤ Odoo el recalcula.

Els ‚Äúfield computed‚Äù no es guarden en la base de  dades, per√≤ en algunes ocasions pot ser que necessitem que es guarde  (per exemple, per a cercar sobre ells). En aquest cas podem usar  ‚Äústore=True‚Äù. Aix√≤ √©s  perill√≥s, ja que pot ser que no recalcule m√©s aquest camp. El decorador  ‚Äú@api.depends()‚Äù soluciona aqueix problema si el ‚Äúcomputed‚Äù dep√©n d'un  altre ‚Äúfield‚Äù. 

En cas de no voler guardar en la base de dades, per√≤ si voler cercar en el camp, Odoo proporciona la funci√≥ ‚Äúsearch‚Äù. Aquesta funci√≥ s'executa quan s'intenta cercar per aqueix camp. Aquesta funci√≥ retornar√† un domini de cerca (aix√≤ s'explicar√† m√©s endavant). El problema √©s que tampoc pot ser un domini molt complex i limita la  cerca.

En poques ocasions necessitem escriure directament en un ‚Äúfield computed‚Äù. Si √©s ‚Äúcomputed‚Äù ser√† perqu√® el seu valor dep√©n d'altres factors. Si es permetera escriure en un ‚Äúfield computed‚Äù, no seria coherent amb els ‚Äúfields‚Äù dels quals dep√©n. No obstant aix√≤, s√≠ que podem permetre que s'escriga directament si fem la funci√≥ ‚Äúinverse‚Äù, la qual ha de sobreescriure els ‚Äúfields‚Äù dels quals dep√©n el ‚Äúcomputed‚Äù perqu√® el c√†lcul siga el que introdueix l'usuari. 

### 4.5 Valors per defecte

En moltes ocasions, per a facilitar el treball als usuaris, alguns ‚Äúfields‚Äù poden tenir un valor per defecte. Aquest valor per defecte pot ser sempre el mateix o ser computat en el moment en qu√® s'inicia el formulari. A difer√®ncia dels ‚Äúfields computed‚Äù, es permet per defecte que l'usuari el modifique i no dep√©n del que l'usuari va introduint en altres ‚Äúfields‚Äù.

Perqu√® un ‚Äúfield‚Äù tinga el valor per defecte, cal posar en el seu constructor l'argument ‚Äúdefault=‚Äù. En cas de ser un valor est√†tic, nom√©s cal posar el valor. En cas de ser un valor per defecte calculat, es pot posar la funci√≥ que el calcula.

```python
name = fields.Char(default="Unknown")
user_id = fields.Many2one('res.users', default=lambda self: self.env.user)
start_date = fields.Date(default=lambda self: fields.Date.today())
active = fields.Boolean(default=True)
def compute_default_value(self):
        return self.get_value()
a_field = fields.Char(default=compute_default_value)
```

A continuaci√≥ expliquem l‚Äôexemple anterior:

- En la primera l√≠nia es veu la manera m√©s f√†cil d'assignar un valor per defecte, una simple cadena de car√†cters per al ‚Äúfield Char‚Äù.
- En la segona l√≠nia s'usa una funci√≥ ‚Äúlambda‚Äù que obt√© l'usuari.
- En la tercera una que obt√© la data.
- En la quarta va un ‚Äúdefault‚Äù simple que assigna un valor boole√†.
- Finalment, tenim una funci√≥ que despr√©s √©s referenciada en el ‚Äúdefault‚Äù de l'√∫ltim ‚Äúfield‚Äù.

Recordem que les funcions ‚Äúlambda‚Äù s√≥n funcions an√≤nimes definides en el lloc on s'invocaran. No poden tenir m√©s d'una l√≠nia.

> üìñ **Atenci√≥**: no √©s funci√≥ d'aquestes anotacions explicar com es programa en Python. Si no les coneixies, √©s molt recomanable que cerques per internet i amplies informaci√≥ sobre les funcions ‚Äúlambda‚Äù. Al llarg d'aquestes anotacions les tornarem a fer servir i podr√†s veure m√©s exemples.

La segona cosa que hi ha √©s la definici√≥ de la funci√≥ abans de ser invocada. Python √©s un llenguatge interpretat i no pot invocar funcions que no s'han definit pr√®viament de ser invocades. En el cas dels ‚Äúfields computed‚Äù, aix√≤ no t√© import√†ncia perqu√® s'invoquen quan l'usuari necessita veure el ‚Äúfield‚Äù. Per√≤ els ‚Äúdefaults‚Äù s'executen quan es reinicia el servidor Odoo i interpreta tots els fitxers Python.

Aquest efecte es pot veure de manera clara en la funci√≥ lambda que calcula l'hora. Si en comptes del que hi ha en l'exemple, pos√†rem directament la funci√≥ ‚Äú**fields.Date.today()**‚Äù, posaria la data de reinici del servidor i no la data de creaci√≥ del registre. En canvi, en referenciar a una funci√≥ ‚Äúlambda‚Äù, aquesta s'executa cada vegada que el programa entra en aqueixa refer√®ncia. Igual que en referenciar a una funci√≥ normal amb nom.

> üí¨ **Interessant**: no hi ha millor manera d'aprendre que provar les coses. Recomanem crear un model nou amb valors per defecte i provar de posar la data nom√©s amb la funci√≥ de data i despr√©s dins de la funci√≥ lambda i comprovar el que passa.

### 4.6 Restriccions (constraints)

No en tots els ‚Äúfields‚Äù els usuaris poden posar de tot. Per exemple, podem necessitar limitar el preu d'un producte en funci√≥ d'uns l√≠mits  preestablits. Si l'usuari crea un nou producte i es passa en posar el  preu, no ha de deixar-li guardar. Les restriccions s'aconsegueixen amb  un decorador anomenat ‚Äú**@api.constraint()**‚Äù el qual executar√† una funci√≥ que revisar√† si l'usuari ha introdu√Øt correctament les dades. Vegem un exemple:

```python
from odoo.exceptions import ValidationError 
... 
@api.constrains('age') 
def _check_age(self):     
	for record in self:
		if record.age > 20:        
			raise ValidationError("Your record is too old: %s" % record.age)
```

Es suposa que hi ha un ‚Äúfield‚Äù anomenat ‚Äúage‚Äù. Quan est√† modificat i s'intenta  guardar es diu a la funci√≥ que t√© el decorador. Aquesta recorre el  ‚Äúrecordset‚Äù (recordem que √©s important posar sempre el ‚Äúfor record in  self‚Äù). Per a cada ‚Äúsingleton‚Äù compara l'edat i si alguna √©s major de  20, llan√ßa un error de validaci√≥. Aquest llan√ßament impedeix que es  guarde en la base de dades i avisa a l'usuari del seu error.

A vegades √©s m√©s c√≤mode posar una restricci√≥ SQL que fer l'algorisme que  el comprova. A m√©s de m√©s eficient en termes de computaci√≥. Per a aix√≤  podem usar una ‚Äú_sql_constraints‚Äù:

```python
_sql_constraints = [ 
('name_uniq', 'unique(name)', 'Custom Warning Message'), 
('contact_uniq', 'unique(contact)', 'Custom Warning Message') 
]
```

Les ‚ÄúSQL contraints‚Äù s√≥n una llista de tuples en les quals est√† el nom de  la restricci√≥, la restricci√≥ SQL i el missatge en cas d‚Äôerrada.

## 5. Vista

L'esquema Model-Vista-Controlador que segueix Odoo, la vista s'encarrega de tot  el que t√© a veure amb la interacci√≥ amb l'usuari. En Odoo, la vista √©s  un programa complet de client en Javascript que es comunica amb el  servidor amb missatges breus. La vista t√© tres parts molt diferents: El  ‚Äúbackend‚Äù, la web i el TPV. **Nosaltres ens centrarem en la vista del ‚Äúbackend‚Äù**. 

![Carrega de vista](/assets/05_04_vista_model.png)

En la primera connexi√≥ amb el navegador web, el servidor Odoo li proporciona un HTML m√≠nim, una SPA (Single Page Application) en Javascript i un CSS. Aix√≤ √©s un client web del servidor, √©s el que es considera la vista. Per√≤ tampoc carrega la vista completa, ja que podria ser immensa. Cada vegada que els men√∫s o botons de la vista requereixen carregar la visualitzaci√≥ d'unes dades, demanen al servidor un XML que definisca com es veuran aqueixes dades i un JSON amb les dades. Llavors la vista renderitza les dades segons l'esquema de l‚ÄôXML i els estils definits en el client. Aquesta visualitzaci√≥ es fa amb uns elements anomenats Ginys, que s√≥n combinacions de CSS, HTML i Javascript que defineixen l'aspecte i comportament d'una mena de dades en una vista en concret. Tot aix√≤ √©s el que veurem amb detall en aquest apartat.

![Renderitzaci√≥ de vista](/assets/05_05_renderitzacio_vista.png)

Els XML que defineixen els elements de la vista es guarden en la base de dades i s√≥n consultats com qualsevol altre model. D'aquesta manera se simplifica la comunicaci√≥ entre el client web i el servidor i el treball del controlador. Com que quan creguem un m√≤dul, volem definir les seues vistes, hem de crear arxius XML per a guardar coses en la base de dades. Aquests seran referenciats en el ‚Äú__manifest__.py‚Äù en l'apartat de data.

> üí¨ **Interessant**: observeu el que ha passat quan es crea un m√≤dul amb ‚Äúscaffold‚Äù. En el ‚Äú__manifest__.py‚Äù hi ha una refer√®ncia a un XML en el directori ‚Äú**views**‚Äù. Aquest XML t√© un exemple comentat dels principals elements de les vistes, que veurem a continuaci√≥.

La vista t√© diversos elements necessaris per a funcionar:

- **Definicions de vistes**: s√≥n els m√©s evidents. S√≥n les mateixes definicions de les vistes, guardades en el model ‚Äú**ir.ui.view**‚Äù. Aquests elements tenen almenys els ‚Äúfields‚Äù que es mostraran i poden tenir informaci√≥ sobre la disposici√≥, el comportament o l'aspecte dels ‚Äúfields‚Äù.
- **Men√∫s**: s√≥n altres elements fonamentals. Estan distribu√Øts de manera jer√†rquica i es guarden en el model **‚Äúir.ui.menu‚Äù**.
- **Actions**: les accions o ‚Äú**actions**‚Äù enllacen una acci√≥ de l'usuari (com pr√©mer en un men√∫) amb una anomenada al servidor des del client per a demanar alguna cosa (com carregar una nova vista). Les ‚Äúaction‚Äù‚Äô estan guardades en diversos models depenent del tipus.

Ac√≠ un exemple complet:

```xml
<odoo>
 <data>
        <!-- explicit list view definition -->
        <record model="ir.ui.view" id="prueba.student_list">
            <field name="name">Student list</field>
            <field name="model">prueba.student</field>
            <field name="arch" type="xml">
               <tree>
                  <field name="name"/>
                  <field name="topics"/>
               </tree>
            </field>
        </record>
        <!-- actions opening views on models -->
        <record model="ir.actions.act_window" id="prueba.student_action_window">
            <field name="name">student window</field>
            <field name="res_model">prueba.student</field>
            <field name="view_mode">tree,form</field>
        </record>
        <!-- Top menu item --> 
        <menuitem name="prueba" id="prueba.menu_root"/>
        <!-- menu categories -->
        <menuitem name="Administration" id="prueba.menu_1" parent="prueba.menu_root"/>
      <!-- actions -->
        <menuitem name="Students" id="prueba.menu_1_student_list" parent="prueba.menu_1"
      action="prueba.student_action_window"/>
 </data>
</odoo>
```

En aquest exemple es veuen ‚Äúrecords‚Äù en XML que indiquen que es guardar√† en la base de dades. Aquests ‚Äúrecords‚Äù diuen el model on es guardar√† i la llista de ‚Äúfields‚Äù que volem guardar.

El primer ‚Äúrecord‚Äù defineix una vista de tipus ‚Äútree‚Äù que √©s una llista d'estudiants on es veuran els camps ‚Äúname‚Äù i ‚Äútopics‚Äù. El segon ‚Äúr√®cord‚Äù √©s la definici√≥ d'un ‚Äúaction‚Äù tipus ‚Äúwindow‚Äù, √©s a dir, que obri una finestra per a mostrar unes vistes de tipus ‚Äútree‚Äù i ‚Äúform‚Äù (formulari). Els altres defineixen tres nivells de men√∫: el superior, l'intermedi i el men√∫ desplegable que cont√© el ‚Äúaction‚Äù. Quan l'usuari navegue pels dos men√∫s superiors i pressione el tercer element de men√∫ s'executar√† aquest ‚Äúaction‚Äù que carregar√† la vista ‚Äútree‚Äù definida i una vista ‚Äúform‚Äù inventada per Odoo.

> üí¨ **Interessant**: per a poder observar un model en el client web d'Odoo no necessitem m√©s que un men√∫ que accione un ‚Äúaction‚Äù tipus ‚Äúwindow‚Äù sobre aqueix model. Odoo √©s capa√ß d'inventar les vistes b√†siques que ens permeten observar-ho. No obstant aix√≤ solen ser menys atractives i √∫tils que les que definim nosaltres. 

Quedem-nos de moment amb la definici√≥ b√†sica d'un ‚Äúaction window‚Äù i dels men√∫s. Ens centrarem abans en les vistes.



### 5.1 Vista Tree

La vista ‚Äútree‚Äù mostra una llista de ‚Äúrecords‚Äù sobre un model. Vegem un exemple b√†sic:

```xml
<record model="ir.ui.view" id="prueba.student_list">
            <field name="name">Student list</field>
            <field name="model">prueba.student</field>
            <field name="arch" type="xml">
               <tree>
                  <field name="name"/>
                  <field name="topics"/>
               </tree>
            </field>
</record>
```

Com es pot observar, aquesta vista es guardar√† en el model ‚Äú**ir.ui.view**‚Äù amb un **external ID** anomenat ‚Äúprueba.student_list‚Äù. T√© m√©s possibles ‚Äúfields‚Äù, per√≤ els m√≠nims necessaris s√≥n ‚Äú**name**‚Äù, ‚Äú**model**‚Äù i ‚Äú**arch**‚Äù. El ‚Äúfield arch‚Äù guarda l‚ÄôXML que ser√† enviat al client perqu√® renderitze la vista.

Dins del ‚Äúfield arch‚Äù est√† l'etiqueta ‚Äú**<tree>**‚Äù que indica que √©s una llista i dins d'aquesta etiqueta tenim m√©s  ‚Äúfields‚Äù que s√≥n els ‚Äúfields‚Äù del model ‚Äúprova.student‚Äù que volem que es vegen.

Aquesta vista ‚Äútree‚Äù es pot millorar de moltes formes. Vegem algunes d'elles:

#### 5.1.1 Colors en les l√≠nies

Odoo no dona llibertat absoluta al desenvolupador en aquest aspecte i permet un nombre limitat d'estils per a donar a les l√≠nies en funci√≥ d'alguna  condici√≥. Aquests estils s√≥n com els de Bootstrap:

- **decoration-bf**: l√≠neas en BOLD 
- **decoration-it:** l√≠neas en ITALICS 
- **decoration-danger**: color LIGHT RED 
- **decoration-info**: color LIGHT BLUE 
- **decoration-muted**: color LIGHT GRAY 
- **decoration-primary**: color LIGHT PURPLE 
- **decoration-success**: color LIGHT GREEN 
- **decoration-warning**: color LIGHT BROWN

```xml
<tree decoration-info="state=='draft'" decoration-danger="state=='trashed'">
```

En aquest exemple es veu com s'assigna un estil en funci√≥ del valor del ‚Äúfield state‚Äù.

>  üí¨ **Interessant**: es pot comparar un ‚Äúfield date‚Äù amb una variable de ‚ÄúQWeb‚Äù anomenada ‚Äú**current_date**‚Äù: 
>
> ```xml
> <tree decoration-info="start_date==current_date">
> ```
>
> 

#### 5.1.2 L√≠nies editables

Si no necessitem un formulari per a modificar alguns ‚Äúfields‚Äù, podem fer el ‚Äútree‚Äù editable.

> ‚ùï **Atenci√≥**: si ho fem editable no s'obrir√† un formulari quan l'usuari fa√ßa clic en un element de la llista.

Per a fer-ho editable cal posar l'atribut ‚Äú**editable=‚Äô[top | bottom]‚Äô**". A m√©s, poden tenir un atribut ‚Äú**on_write**‚Äù que indica qu√® fer quan s'edita.

#### 5.1.3 Camps invisibles

Alguns camps nom√©s han d'estar per a definir el color de la l√≠nia, servir com a llan√ßador d'un ‚Äúfield computed‚Äù o ser cercats, per√≤ l'usuari no  necessita veure'ls. Per a aix√≤ es pot posar l'atribut ‚Äú**invisible=‚Äô1‚Äô**‚Äù en el ‚Äúfield‚Äù que necessitem.

#### 5.1.4 C√†lculs de totals

En els ‚Äúfields‚Äù num√®rics, si volem mostrar la suma total, podem usar l'atribut ‚Äúsum‚Äù.

Exemple de com quedaria una vista ‚Äútree‚Äù amb tot el que hem explicat:

```xml
<record model="ir.ui.view" id="prova.student_list">
         <field name="name">Student list</field>
         <field name="model">prova.student</field>
         <field name="arch" type="xml">
             <tree decoration-info="qualification&lt;5" editable="top">
                <field name="name"/>
                <field name="topics" invisible="true"/>
         <field name="qualification" sum="Total Qualifications"/>
             </tree>
         </field>
</record>
```



### 5.2 Vista Form

Aquesta vista permet editar o crear un nou registre en el model que represente. Mostra un formulari que t√© versi√≥ editable i versi√≥ ‚Äúnom√©s vista‚Äù. En tenir dues versions i necessitar m√©s  complexitat, la vista ‚Äúform‚Äù t√© moltes m√©s opcions.

> ‚ùï **Atenci√≥**: en aquesta vista cal tenir en compte que al final es traduir√† en elements  HTML i CSS i que els selectors CSS s√≥n estrictes amb l'ordre i jerarquia de les etiquetes. Per tant, no totes les combinacions funcionen sempre.

El formulari deixa certa llibertat al desenvolupador per a controlar la  disposici√≥ dels ‚Äúfields‚Äù i l'est√®tica. No obstant aix√≤, hi ha un esquema que conv√© seguir.

Un formulari pot ser l'etiqueta ‚Äú**<form>**‚Äù amb etiquetes de ‚Äúfields‚Äù dins, igual que el ‚Äútree‚Äù. Per√≤ aconseguir un bon resultat ser√† m√©s complicat i cal introduir elements HTML. Odoo  proposa uns contenidors amb uns estils predefinits que funcionen b√© i  estandarditzen els formularis de tota l'aplicaci√≥.



Perqu√® un formulari quede b√© i no ocupe tota la pantalla es pot usar l'etiqueta ‚Äú**<sheet>**‚Äù que englobe a la resta d'etiquetes. Si la utilitzem, els ‚Äúfields‚Äù  perdran el ‚Äúlabel‚Äù, per la qual cosa hem de fer servir l'etiqueta‚Äú**<group string=‚Äùnom del grup‚Äù>**‚Äù abans de les dels ‚Äúfields‚Äù. Tamb√© es pot posar en cada ‚Äúfield‚Äù l'etiqueta ‚Äú**<label for="nom del field">**‚Äù.

Si fem diversos ‚Äú**groups**‚Äù o ‚Äúgroups dins de groups‚Äù, el CSS d'Odoo ja alinea els ‚Äúfields‚Äù en  columnes o els separa correctament. No obstant aix√≤, si volem separar  manualment alguns ‚Äúfields‚Äù, podem fer servir l'etiqueta ‚Äú**<separator string="nom  del separador"/>**‚Äù.

Un altre element de separaci√≥ i organitzaci√≥ √©s ‚Äú**<notebook> <page string="titol">**‚Äù, que crea unes pestanyes que amaguen parts del formulari i permeten que c√†pia en la pantalla.



> ‚ùï **Atenci√≥**: les combinacions de ‚Äúgroup‚Äù, ‚Äúlabel‚Äù, ‚Äúseparator‚Äù, ‚Äúnotebook‚Äù i ‚Äúpage‚Äù s√≥n  moltes. Es recomana veure com han fet els formularis en algunes parts  d'Odoo. Els formularis oficials tenen moltes coses m√©s complexes.  Algunes d'elles les observarem a continuaci√≥.

Una vegada esmentats els elements d'estructura del formulari, veurem com modificar l'aparen√ßa dels ‚Äúfields‚Äù.



#### 5.2.1 Definir una vista ‚Äútree‚Äù espec√≠fica als ‚ÄúX2many‚Äù

Els ‚ÄúOne2many‚Äù i ‚ÄúMany2many‚Äù es mostren, per defecte, dins d'un formulari  com una sub-vista ‚Äútree‚Äù. Odoo agafa la vista ‚Äútree‚Äù amb m√©s prioritat  del model al qual fa refer√®ncia el ‚ÄúX2many‚Äù i la incrusta dins del  formulari. Aix√≤ provoca dos problemes:

- Si canvies aquella vista tamb√© canvien els formularis.
- Les vistes ‚Äútree‚Äù quan s√≥n independents solen mostrar m√©s ‚Äúfields‚Äù dels quals necessites dins d'un formulari que les referencia.

Per aix√≤ es pot definir un ‚Äútree‚Äù dins del ‚Äúfield‚Äù:

```xml
<field name="subscriptions" colspan="4">
  <tree>...</tree>
</field>
```



#### 5.2.2 Widgets

Un ‚Äúwidget‚Äù √©s un component del client web que serveix per a representar  una dada d'una forma determinada. Un ‚Äúwidget‚Äù t√© una plantilla HTML, un  estil amb CSS i un comportament definit amb Javascript. Si volem, per  exemple, mostrar i editar dates, Odoo t√© un ‚Äúwidget‚Äù per als ‚ÄúDatetime‚Äù  que mostra la data amb format de data i mostra un calendari quan estem  en manera edici√≥.

Alguns  ‚Äúfields‚Äù poden mostrar-se amb diferents ‚Äúwidgets‚Äù en funci√≥ del que  vulguem. Per exemple, les imatges per defecte estan en un ‚Äúwidget‚Äù que  permet descarregar-les, per√≤ no veure-les en la web. Si li posem  ‚Äúwidget=‚Äôimage‚Äô‚Äù les mostrar√†. 

√âs possible fer els nostres propis ‚Äúwidgets‚Äù, no obstant aix√≤, requereix  saber modificar el client web, la qual cosa no est√† contemplat en  aquesta unitat did√†ctica.

Ac√≠ tenim alguns ‚Äúwidgets‚Äù disponibles per a ‚Äúfields‚Äù num√®rics:

- **integer**: el n√∫mero sense comes. Si est√† buit, mostra un 0.
- **char**: el car√†cter, encara que mostra el camp m√©s ample. Si est√† buit mostra un buit.
- **id**: no es pot editar.
- **float**: el n√∫mero amb decimals
- **percentpie**:  un gr√†fic circular amb el percentatge.
- **progressbar**: una barra de progr√©s
- **monetary**: amb dues decimals.
- **field_float_rating**: estreles en funci√≥ d'un float.

Per als ‚Äúfields‚Äù de text tenim alguns que amb el seu nom s'expliquen a soles pel seu nom: char, text, email, url, date, html.

Per als booleans, a partir d'Odoo 13 es pot mostrar una cinta al costat del formulari amb el ‚Äúwidget‚Äù anomenat ‚Äú**web_ribbon**‚Äù.

Els ‚Äúfields‚Äù relacionals es mostren per defecte com un ‚Äúselection‚Äù o un ‚Äútree‚Äù, per√≤ poden ser:

- **many2onebutton**: indica nom√©s si est√† seleccionat
- **many2many_tags**: que mostra les dades com etiquetes. 

> ‚ùï **Atenci√≥**: la llista de ‚Äúwidgets‚Äù √©s molt llarga i van entrant i eixint en les  diferents versions d'Odoo. Recomanem explorar els m√≤duls oficials i  veure com s'utilitzen per a copiar el codi en el nostre m√≤dul. Hi ha  molts m√©s, alguns sols estan si has instal¬∑lat un determinat m√≤dul,  perqu√® es van fer a prop√≤sit per a aqueix m√≤dul, encara que els pots  aprofitar si el poses com a depend√®ncia.

#### 5.2.3 Valors per defecte en els One2many

Quan tenim un ‚ÄúOne2many‚Äù en una vista ‚Äúform‚Äù, ens dona l'opci√≥ de crear nous registres. Recordem que un ‚ÄúOne2many‚Äù no √©s m√©s que una representaci√≥  del ‚ÄúMany2one‚Äù que hi ha en l'altre model. Per tant, si creem nous  registres, necessitem que el ‚ÄúMany2one‚Äù del model a crear referencie al  registre que estem modificant del model que t√© el formulari. 

Per a aconseguir que el formulari que sale en la finestra emergent tinga aqueix valor per defecte, el que farem ser√† passar per context una dada amb un nom especial que ser√† interpretat: **context="{'default_<nom del field many2one>':active_id}**". 

Aix√≤ es pot fer tamb√© en un ‚Äúaction‚Äù. De fet, en pressionar un element del ‚Äútree‚Äù s'executa un ‚Äúaction‚Äù tamb√©:

```xml
<field name="context">{"default_doctor": active_id}</field>
```

> ‚ùï **Atenci√≥**: el concepte de context en Odoo no est√† explicat encara. De moment  pensem que √©s un calaix de sastre on posar les variables que volem  passar de la vista al controlador i viceversa.

La paraula reservada ‚Äúactive_id‚Äù √©s una variable que apunta al ‚Äúid‚Äù del registre que est√† actiu en aquest formulari. Per saber m√©s de com utilitzar ‚Äúcontext‚Äù podeu consultar [https://www.cybrosys.com/blog/how-to-use-context-and-domain-in-odoo-13](https://www.google.com/url?q=https://www.cybrosys.com/blog/how-to-use-context-and-domain-in-odoo-13&sa=D&source=editors&ust=1726775625775578&usg=AOvVaw1NbnDoc5-tESxKLBE0gTr5) i [https://odootricks.tips/about/building-blocks/context/](https://www.google.com/url?q=https://odootricks.tips/about/building-blocks/context/&sa=D&source=editors&ust=1726775625775911&usg=AOvVaw3MfzO1CgvsiImDMaKJ0-wI).

#### 5.2.4 Domains als Many2one

Encara que es poden definir en el model, pot ser que en una vista determinada  necessitem un ‚Äúdomain‚Äù m√©s espec√≠fic. Aix√≠ es defineixen:

```xml
<field name="hotel" domain="[('ishotel', '=', True)]"/>
```

#### 5.2.5 Formularis din√†mics

El client web d'Odoo √©s una web reactiva. Aix√≤ vol dir que reacciona a les accions de l'usuari o a esdeveniments de manera autom√†tica. Part  d'aquesta reactivitat es pot definir en la vista ‚Äúform‚Äù fent que es  modifique en funci√≥ de diversos factors. Aix√≤ s'aconsegueix amb  l'atribut ‚Äúattrs‚Äù entre altres dels ‚Äúfields‚Äù.

**Es pot ocultar condicionalment un ‚Äúfield‚Äù**:

```xml
<field name="boyfriend_name" attrs="{'invisible':[('married', '!=', False)]}" />
<field name="boyfriend_name" attrs="{'invisible':[('married', '!=', 'selection_key')]}" />
```

Es pot mostrar o ocultar en manera edici√≥ o lectura:

```xml
<field name="partido" class="oe_edit_only"/>
<field name="equipo" class="oe_read_only"/>
```

Molts formularis tenen estats i es comporten com un assistent. En funci√≥ de  cada estat es poden mostrar o ocultar ‚Äúfields‚Äù. Hi ha una drecera a  l'exemple anterior si tenim un ‚Äúfield‚Äù que espec√≠ficament es diu  ‚Äústate‚Äù. Amb l'atribut ‚Äústates‚Äù es pot mostrar o ocultar elements de la  venda:

```xml
<group states="i,c,d">                         
   <field name="name"/>
</group>
```



Tamb√© existeix l'opci√≥ d'ocultar una columna d'un ‚Äútree‚Äù d'un ‚ÄúX2many‚Äù:

```xml
<field name="lot_id" attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])] }"/>
```



> üí¨ **Interessant**: fixa't en l'exemple anterior que diu ‚Äúparent.state‚Äù. Aix√≤ fa refer√®ncia al  ‚Äúfield state‚Äù del model pare d'aqueix ‚Äútree‚Äù. Cal tenir en compte que  aqueix ‚Äútree‚Äù es mostra amb el model al qual fa refer√®ncia el ‚ÄúX2many‚Äù,  per√≤ est√† dins d'un formulari d'un altre model.

Dins dels formularis din√†mics, **es pot editar condicionalment un ‚Äúfield‚Äù**. Aix√≤ vol dir que permetr√† a l'usuari modificar un ‚Äúfield‚Äù en funci√≥ d'una condici√≥:

```xml
<field name="name2" attrs="{'readonly': [('condition', '=', False)]}"/>
```

Vegem ara un exemple amb tots els ‚Äúattrs‚Äù:

```xml
<field name="name" attrs="{'invisible': [('condition1', '=', False)],
                          'required': [('condition2', '=', True)],
                          'readonly': [('condition3','=',True)]}" />
```



#### 5.2.6  Assistents

Els formularis d'Odoo poden ser assistents amb les t√®cniques que acabem  d'estudiar. A partir d'Odoo 11 s'usa el ‚Äúfield status‚Äù, l'atribut  ‚Äústates‚Äù i un ‚Äúwidget‚Äù anomenat ‚Äústatusbar‚Äù que mostra aquest ‚Äúfield‚Äù en la part superior del formulari com unes fletxes. 

```xml
<field name="state" widget="statusbar" statusbar_visible="draft,sent,progress,invoiced,done" />
```



### 5.3 Vista Kanban

La vista ‚Äútree‚Äù i la vista ‚Äúform‚Äù s√≥n les que funcionen per defecte en  qualsevol ‚Äúaction‚Äù. La resta de vistes, com la ‚ÄúKanban‚Äù, necessiten una  definici√≥ en XML per a funcionar.

A m√©s, donada la gran quantitat d'opcions que tenim en fer un ‚ÄúKanban‚Äù,  no disposem d'etiquetes com en el ‚Äúform‚Äù que despr√©s es tradu√Øsquen en  HTML o CSS i donen un format est√†ndard i confortable. Quan estem  definint una vista ‚ÄúKanban‚Äù entrem en el terreny del llenguatge ‚ÄúQWeb‚Äù i de l'HTML o CSS expl√≠cit.



> üí¨ **Interessant**: aprendre els detalls de QWeb, HTML i CSS necessaris per a dominar el  disseny dels ‚ÄúKanban‚Äù suposa molt espai que no podem dedicar en aquest  cap√≠tol. De moment, la millor manera de fer-los √©s entendre com  funcionen els exemples i mirar, copiar i pegar el codi dels ‚ÄúKanban‚Äù que ja estan fets.

Vegem un exemple m√≠nim de ‚ÄúKanban‚Äù on descriurem posteriorment per a qu√® serveixen les etiquetes i atributs.

```xml
<record model="ir.ui.view" id="terraform.planet_kanban_view">
               <field name="name">Student kanban</field>
               <field name="model">school.student</field>
               <field name="arch" type="xml">
                   <kanban>
                   <!-- Estos fields se cargan inicialmente y pueden ser utilizados
                   por la l√≥gica del Kanban -->
                       <field name="name" />
                       <field name="id" /> <!-- Es importante a√±adir el id para el
                       record.id.value posterior -->
                       <field name="image" />
                       <templates>
                           <t t-name="kanban-box">
                               <div class="oe_product_vignette"> 
                          <!-- Aprovechando un CSS de products -->
                                   <a type="open">
                                       <img class="o_image_64_contain"
                                            t-att-alt="record.name.value"
                                            t-att-src="kanban_image('school.student', 'image', record.id.raw_value)" />
                                   </a>
                   <!-- Para obtener la imagen necesitamos una funci√≥n javascript
                        que proporciona Odoo Llamada kanban-image y esta necesita
                        el nombre del modelo, el field y el id para encontrarla -->
                  <!-- record es una variable que tiene QWeb para acceder a las
                       propiedades del registro que estamos mostrando. Las propiedades
                       accesibles son las que hemos puesto en los fields de arriba. -->
                                   <div class="oe_product_desc">
                                       <h4>
                                   <a type="edit"> <!-- Abre un formulario de edici√≥n -->
                                                 <field name="id"></field>
                                                 <field name="name"></field>
                                   </a>
                                       </h4>
                                   </div>
                               </div>
                           </t>
                       </templates>
                   </kanban>
               </field>
           </record>
```

### 5.4 Vista Calendar

Aquesta vista mostra un calendari si les dades dels registres del model tenen  almenys un ‚Äúfield‚Äù que indica una data i un altre que indique una data  final o una duraci√≥. 

La sintaxi √©s molt simple, vegem un exemple:

```xml
<record model="ir.ui.view" id="school.travel_calendar">
               <field name="name">travel calendar</field>
               <field name="model">school.travel</field>
               <field name="arch" type="xml">
                   <calendar string="Travel Calendar" date_start="launch_time"
              date_delay="distance" <!-- Puede ser delay (en horas) o date_stop -->
              color="origin_school"> <!-- El color indica el field que lo modifica
                                                No un color literalmente -->
                       <field name="name"/>
                   </calendar>
               </field>
</record>
```

Per defecte el ‚Äú**delay**‚Äù ho divideix en dies segons la duraci√≥ de la jornada laboral. Aquesta es pot modificar amb l'atribut ‚Äú**day_length**‚Äù.

### 5.5 Vista Graph

La vista ‚Äúgraph‚Äù permet mostrar una gr√†fica a partir d'alguns ‚Äúfields‚Äù  num√®rics que tinga el model. Aquesta vista pot ser de tipus ‚Äúpie‚Äù  (past√≠s en angl√©s), ‚Äúbar‚Äù o ‚Äúline‚Äù i es comporta agregant els valors que ha de mostrar.

En aquest exemple es veu  un gr√†fic en el qual es mostrar√† l'evoluci√≥ de les notes en el temps de  cada estudiant. Per aix√≤ el temps es posa com ‚Äú**row**‚Äù, l'estudiant com a ‚Äú**col**‚Äù i les dades a mostrar que s√≥n les qualificacions com ‚Äú**measure**‚Äù. En cas d'oblidar posar a l‚Äôestudiant com a ‚Äú**col**‚Äù ens mostraria l'evoluci√≥ en el temps de la suma de les notes de tots els estudiants.

```xml
<record model="ir.ui.view" id="school.qualifications_graph">
         <field name="name">Qualifications graph</field>
         <field name="model">school qualifications</field>
         <field name="arch" type="xml">
              <graph string="Qualifications History" type="line">
                   <field name="time"  type="row"/>
            <field name="student"  type="col"/>
                   <field name="qualification" type="measure"/>
              </graph>
         </field>
</record>
```



### 5.6 Vista Search

Aquesta no √©s una vista com les que hem vist fins ara. Entra dins de la mateixa categoria i es guarda en el mateix model, per√≤ **no es mostra ocupant la finestra, sin√≥ la part superior on se situa el formulari de cerca**. El que permet √©s definir els criteris de cerca, filtrat o agrupament dels registres que es mostren en el client web.

Vegem un exemple complet de vista ‚Äúsearch‚Äù:

```xml
<search>
<field name="name"/>
<field name="inventor_id"/>
<field name="description" string="Name and description" filter_domain="['|', ('name', 'ilike', self), ('description', 'ilike', self)]"/>
<field name="boxes" string="Boxes or @" filter_domain=   "['|',('boxes','=',self),('kg','=',self)]"/>
<filter name="my_ideas" string="My Ideas" domain="[('inventor_id', '=', uid)]"/>
<filter name="more_100" string="More than 100 boxes" domain="[('boxes','>',100)]"/>
<filter name="Today" string="Today" domain="[('date', '&gt;=', datetime.datetime.now().strftime('%Y-%m-%d 00:00:00')),('date', '&lt;=', datetime.datetime.now().strftime('%Y-%m-%d 23:23:59'))]"/>
<filter name="group_by_inventor" string="Inventor" context="{'group_by': 'inventor_id'}"/>
<filter name="group_by_exit_day" string="Exit" context="{'group_by': 'exit_day:day'}"/>
</search>
```



L'etiqueta ‚Äú**field**‚Äù dins d'un ‚Äú**search**‚Äù permet indicar per qu√® ‚Äúfields‚Äù cercar√†. Es pot posar l'atribut ‚Äú**filter_domain**‚Äù si volem incorporar una cerca m√©s avan√ßada fins i tot amb diversos  ‚Äúfields‚Äù. S'usar√† la sintaxi dels dominis que ja hem usat en Odoo en  altres ocasions.

L'etiqueta ‚Äú**filter**‚Äù estableix un filtre predefinit que s'aplicar√† prement en el men√∫. Necessita l'atribut ‚Äú**domain**‚Äù perqu√® fa√ßa la cerca.

L'etiqueta ‚Äú**filter**‚Äù tamb√© pot servir per a agrupar en funci√≥ d'un criteri. Per a aix√≤, cal posar en el ‚Äú**context**‚Äù la clau ‚Äú**group_by**‚Äù, de manera que far√† una cerca i agrupar√† pel criteri que li diguem. Hi  ha un tipus especial d'agrupaci√≥ per data (√∫ltim exemple) en la qual  podem especificar si volem agrupar per dia, mes o uns altres.



## 6. Seguretat en models Odoo

Odoo necessita con√©ixer que permisos tenen els usuaris/rols del sistema per a cada model particular del nostre m√≤dul. En el fitxer ‚Äú**\__manifest__.py**‚Äù s'indica un la ruta a un fitxer on es detallen aquests permisos, d'una forma similar a:

```xml
'data': ['security/ir.model.access.csv',]
```

El contingut del fitxer √©s una cap√ßalera, indicant que √©s cada camp (d'una manera molt descriptiva), seguit d'un conjunt de l√≠nies, cadascuna  definint una ACL (Access Control List).

Vegem un exemple:

```csv
id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink acl_lista_tareas,lista_tareas.lista_default,model_lista_tareas_lista,base.group_user,1,1,1,1
```

En aqueix exemple es defineix:

- Una ACL amb ‚Äúid‚Äù anomenada ‚Äúacl_lista_tareas‚Äù.
- Un nom que indique que afecta al model ‚Äúlista_tareas.lista‚Äù (i s'indica amb ‚Äúlista_tareas.lista_default_model‚Äù).
- El model ‚Äúlista_tareas.lista‚Äù, indicat pel seu ‚ÄúExternal ID‚Äù com ‚Äúmodel_lista_tareas_lista‚Äù.
- El grup al qual s'aplica aquesta ACL. Indicant ‚Äúbase.group_user‚Äù s‚Äôaplica a tots els usuaris.
- Una llista de permisos (lectura, escriptura, creaci√≥ i esborrat) on ‚Äú1‚Äù indica ‚Äúperm√≠s concedit‚Äù i ‚Äú0‚Äù indica ‚Äúperm√≠s denegat‚Äù.

Si volem definir grups propis perq l‚ÄôACL, a banda dels que puga poseir  Odoo, podem fer-ho indicant en ‚Äú**\__manifest__.py**‚Äù un fitxer de definici√≥  de grups de forma similar a aquesta:

```xml
'data': ['security/groups.xml','security/ir.model.access.csv',]
```

Vegem un exemple de definici√≥ de grup:

```xml
<?xml version="1.0" encoding="utf-8"?>
<odoo>
        <record id="grupo_bibliotecario" model="res.groups">
           <field name="name">Bibliotecario</field>
           <field name="users" eval="[(4, ref('base.user_admin'))]" />
        </record>
</odoo>
```

Amb aquest exemple, hem creat el  ‚Äúgrupo_bibliotecario‚Äù i ho hem poblat afegint els usuaris que pertanguen al grup d'administradors (‚Äúbase.user_admin‚Äù). Per a usar-ho al fitxer  ‚Äúcsv‚Äù amb les ACL, simplement haurem d'indicar en el camp grup  ‚Äúgrupo_bibliotecario‚Äù. 

M√©s informaci√≥ en [www.odoo.yenthevg.com/creating-security-groups-odoo/](https://www.google.com/url?q=http://www.odoo.yenthevg.com/creating-security-groups-odoo/&sa=D&source=editors&ust=1726775625797806&usg=AOvVaw3JprvM4wi_G8GQwU2tinPa) i en [https://www.odoo.com/documentation/17.0/es/developer/tutorials/server_framework_101/04_securityintro.html](https://www.google.com/url?q=https://www.odoo.com/documentation/17.0/es/developer/tutorials/server_framework_101/04_securityintro.html&sa=D&source=editors&ust=1726775625798129&usg=AOvVaw0kN7sl-LjsgK-V-fpP_8Gm)



## 7. M√≤duls d'exemple amb comentaris

Es poden trobar exemples de m√≤duls d'Odoo comentats amb els conceptes tractats durant la unitat en [https://github.com/sergarb1/OdooModulosEjemplos](https://www.google.com/url?q=https://github.com/sergarb1/OdooModulosEjemplos&sa=D&source=editors&ust=1726775625798493&usg=AOvVaw3lgNw3WtiorbJh5MAKaG5t)



## 8. Activitats

### Activitat 01

Modifica l‚Äôexemple m√©s senzill de la llista de tasques de forma que:

- Tinga una nova vista per veure les tasques en format ‚ÄúKanban‚Äù.
- Modifica les tasques per tindre una data assignada i crea una nova vista per veure en una vista ‚ÄúCalendar‚Äù la data assignada.

### Activitat 02

Amplia el m√≤dul de l‚Äôexemple de biblioteca de c√≤mics de forma que:

- Incloure la possibilitat de gestionar socis, emmagatzemar nom, cognom e identificador.
- Introdu√Øu la possibilitat que hi haja exemplars de c√≤mics per prestar.

- El model de c√≤mic actual ha de servir com a refer√®ncia de la informaci√≥  del c√≤mic. A banda d‚Äôaquest model, jaureu de plantejar un nou model per a indicar exemplars de pr√©stec d‚Äôeixe c√≤mic. 
- Aquests exemplars de pr√©stec hauran de controlar nom√©s a qui estan prestats i  la data d‚Äôinici i data de final del pr√©stec. No cal tindre un hist√≤ric  de pr√©stecs, nom√©s qui t√© el c√≤mic en cada moment, quan se l‚Äôha prestat i la data prevista de tornada.

- La data de pr√©stec no pot ser posterior al dia de hui.
- La data prevista de tornada no pot ser anterior al dia de hui.

### Activitat 03

Crea un m√≤dul per a gestionar pacients i metges d‚Äôun hospital.

Per cada pacient, tindrem un model amb les seg√ºents dades:

- Nom i cognoms del pacient.
- S√≠mptomes.

Per cada metge, tindrem un model amb les seg√ºents dades:

- Nom i cognoms del metge.
- N√∫mero de col¬∑legiat.

Per cada vegada que un metge ha at√©s un pacient, tindrem un model indicant el diagn√≤stic.

Un pacient pot haver sigut at√©s per diversos metges i un metge pot haver at√©s diversos pacients.

Implementa els models i les vistes que cregues adequades per als 3 models.

### Activitat 04

Fes un m√≤dul d‚ÄôOdoo que represente els nostres estudis de cicles formatius a un institut:

- Model Cicle formatiu. Cada inst√†ncia representa a un cicle formatiu en un institut. Un cicle t√© un o m√©s m√≤duls associats-
- Model M√≤dul. Cada ‚Äúm√≤dul‚Äù estar√† relacionat amb cicles formatius (al qual  pertany), alumnes matriculats i professor que ho imparteix.
- Model Alumne. Relacionat amb els m√≤duls que t√© matriculat.
- Model Professor. Relacionat amb els m√≤duls que imparteix.

Implementa els models, les relacions necess√†ries i les vistes que cregues adequades per als 4 models.

Una vegada en funcionament l‚Äôaplicaci√≥, volem que implementes la seg√ºent configuraci√≥ de seguretat:

- Els usuaris amb el rol ‚ÄúDirector‚Äù podran modificar els registres dels models anteriors.
- A m√©s del director, els √∫nics usuaris que podran veure les dades dels  professors (en mode lectura) seran els usuaris amb rol ‚ÄúProfessor‚Äù. 
